<h3 id="æ¶æ„ä¸å·¥ä½œæµ-architecture-workflow"><a class="header-anchor" href="#æ¶æ„ä¸å·¥ä½œæµ-architecture-workflow">#</a>ğŸ—ï¸ æ¶æ„ä¸å·¥ä½œæµ (Architecture &amp; Workflow)</h3><p>Lupine.js è¿è¡Œä¸€ä¸ªå•ä¾‹æœåŠ¡å™¨å®ä¾‹ï¼Œå¯ä»¥åŒæ—¶æœåŠ¡å¤šä¸ªåŸŸåå’Œåº”ç”¨ç¨‹åºã€‚</p>
<p><strong>1. åº”ç”¨å®šä¹‰ (App Definition)</strong>
åº”ç”¨åœ¨ <code>.env</code> æ–‡ä»¶ä¸­é€šè¿‡ <code>APPS</code> å˜é‡å®šä¹‰ï¼ˆä¾‹å¦‚ <code>APPS=doc,demo.app</code>ï¼‰ã€‚åŸŸåæ˜ å°„ä¹Ÿåœ¨ <code>.env</code> ä¸­é…ç½®ï¼ˆä¾‹å¦‚ <code>DOMAINS@demo.app=example.com</code>ï¼‰ã€‚</p>
<p><strong>2. ç¼–è¯‘ (Compilation)</strong>
åœ¨æ„å»º/å¼€å‘æœŸé—´ï¼Œ<code>dev-watch.js</code> è¯»å–æ¯ä¸ªåº”ç”¨ç›®å½•ä¸‹çš„ <code>lupine.json</code> ä»¥æ‰¾åˆ° <code>webEntryPoints</code> å¹¶è¿›è¡Œç¼–è¯‘ã€‚</p>
<p><strong>3. è¯·æ±‚æµç¨‹ (Request Flow)</strong>
å½“è¯·æ±‚åˆ°è¾¾æ—¶ï¼š</p>
<ol>
<li><strong>åº”ç”¨è§£æ</strong>: <code>AppHelper</code> æ ¹æ®è¯·æ±‚çš„ä¸»æœºåè¯†åˆ«ç›®æ ‡åº”ç”¨ã€‚</li>
<li><strong>æ¨¡å—åŠ è½½</strong>: åŠ è½½å¯¹åº”çš„ <code>ApiModule</code> (åœ¨ <code>api/src/index.ts</code> ä¸­å®šä¹‰)ã€‚</li>
<li><strong>è·¯ç”±</strong>: <code>RootApi</code> å°è¯•åŒ¹é… API è·¯ç”±ã€‚å¦‚æœæœªåŒ¹é…ï¼Œåˆ™å›é€€åˆ° <code>StaticServer</code>ã€‚</li>
</ol>
<p><strong>4. é™æ€æœåŠ¡ä¸ SSR</strong>
<code>StaticServer</code>:</p>
<ul>
<li>æ£€æŸ¥è¯·æ±‚çš„é™æ€æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚</li>
<li>å¦‚æœæœªæ‰¾åˆ°ï¼Œå®ƒå°†è§¦å‘ <strong>SSR</strong> (<code>serverSideRenderPage</code>)ã€‚</li>
</ul>
<p>è¿™ç¡®ä¿äº†ä¸€ä¸ªå•ä¸€å…¥å£ç‚¹å¯ä»¥æ— ç¼å¤„ç† APIã€é™æ€èµ„æºå’Œ SSR é¡µé¢ç”Ÿæˆã€‚</p>
<p>åç«¯æœåŠ¡çš„ä¸»æ¨¡å—ã€‚æ¯ä¸€ä¸ªæœ‰åç«¯çš„ App éƒ½å¿…é¡»å®è£…ä¸€ä¸ª <code>ApiModule</code>ã€‚</p>
<pre><code class="language-typescript">import { ApiModule } from &#39;lupine.api&#39;;
import { RootApi } from &#39;./service/root-api&#39;;

export const apiModule = new ApiModule(new RootApi());
</code></pre>
<h3 id="rootapi-ä¸-staticserver"><a class="header-anchor" href="#rootapi-ä¸-staticserver">#</a>ğŸŒ³ RootApi ä¸ StaticServer</h3><p><code>RootApi</code> æ˜¯åº”ç”¨ç¨‹åºé€»è¾‘çš„å…¥å£ç‚¹ã€‚å®ƒé€šå¸¸æŒ‚è½½ç‰¹å®šçš„ API ä»¥åŠ <code>StaticServer</code> æ¥å¤„ç†æ–‡ä»¶è¯·æ±‚å’Œ SSR å›é€€ã€‚</p>
<pre><code class="language-typescript">// src/service/root-api.ts
import { IApiBase, ApiRouter, StaticServer } from &#39;lupine.api&#39;;

export class RootApi implements IApiBase {
  protected router = new ApiRouter();

  constructor() {
    this.mountRoutes();
  }

  protected mountRoutes() {
    // 1. æŒ‚è½½ä½ çš„ App API
    this.router.use(&#39;/api&#39;, new Api().getRouter());

    // 2. æŒ‚è½½é™æ€æœåŠ¡å™¨ (Static Server) (å¤„ç†é™æ€æ–‡ä»¶ + SSR)
    // é‡è¦ï¼šå¿…é¡»æ”¾åœ¨æœ€åä»¥æ•è·é API è¯·æ±‚
    const staticServer = new StaticServer();
    this.router.use(&#39;*&#39;, staticServer.processRequest.bind(staticServer));
  }
}
</code></pre>
<h3 id="å¥åº·æ£€æŸ¥ç¤ºä¾‹-health-check"><a class="header-anchor" href="#å¥åº·æ£€æŸ¥ç¤ºä¾‹-health-check">#</a>ğŸ¥ å¥åº·æ£€æŸ¥ç¤ºä¾‹ (Health Check)</h3><p>è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ API ç«¯ç‚¹ç¤ºä¾‹ï¼ˆä¾‹å¦‚ç”¨äºå¥åº·æ£€æŸ¥ï¼‰ã€‚</p>
<pre><code class="language-typescript">// src/service/api.ts
import { IApiBase, ApiRouter, ServerRequest } from &#39;lupine.api&#39;;
import { ServerResponse } from &#39;http&#39;;

export class Api implements IApiBase {
  protected router = new ApiRouter();

  constructor() {
    this.router.use(&#39;/health-check&#39;, this.healthCheck.bind(this));
  }

  async healthCheck(req: ServerRequest, res: ServerResponse) {
    res.writeHead(200, { &#39;Content-Type&#39;: &#39;application/json&#39; });
    res.write(JSON.stringify({ status: &#39;OK&#39;, uptime: process.uptime() }));
    res.end();
    return true; // è¿”å› true è¡¨ç¤ºè¯·æ±‚å·²è¢«å¤„ç†
  }

  public getRouter() {
    return this.router;
  }
}
</code></pre>
